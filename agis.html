<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGÄ°S - Analiz ve GeliÅŸim Sistemi (KayÄ±tlÄ±)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; min-height: 100vh; }
        .tab-button { transition: all 0.1s; }
        .active-tab { 
            border-bottom: 3px solid #4f46e5; 
            color: #4f46e5; 
            font-weight: 600;
        }
        .analiz-card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-top: 1rem;
        }
        .input-alan { width: 60px; text-align: center; }
        .tablo-satir th {
            font-weight: 600;
            color: #1f2937; /* gray-800 */
        }
    </style>
</head>
<body>

<div class="w-full max-w-6xl mx-auto p-6 md:p-10 mt-8">

    <header class="pb-4 border-b border-gray-200 mb-6">
        <a href="dersler.html" class="text-indigo-600 hover:text-indigo-800 text-xl mb-4 inline-block">â† Ders SeÃ§imi</a>
        <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">ğŸ“ˆ AGÄ°S: Analiz ve GeliÅŸim Sistemi (KayÄ±tlÄ±)</h1>
        <p class="text-sm text-gray-500 mt-2">Verileriniz otomatik olarak kaydedilir ve yeniden yÃ¼klendiÄŸinde gÃ¶rÃ¼nÃ¼r.</p>
    </header>

    <div class="border-b border-gray-200 mb-6">
        <nav class="flex space-x-4">
            <button id="tab-sozel" class="tab-button py-2 px-4 text-gray-500 hover:text-indigo-600 active-tab">
                SÃ¶zel Dersler (TÃ¼rkÃ§e, Sosyal, Din, Ä°ngilizce) âœï¸
            </button>
            <button id="tab-sayisal" class="tab-button py-2 px-4 text-gray-500 hover:text-indigo-600">
                SayÄ±sal Dersler (Matematik, Fen Bilimleri) ğŸ”¢
            </button>
        </nav>
    </div>

    <main id="content-sozel" class="space-y-8">
        <div class="analiz-card">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">SÃ¶zel Net Hesaplama</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-3 text-left text-sm font-medium text-gray-700">Ders</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-green-600">DoÄŸru (D)</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-red-600">YanlÄ±ÅŸ (Y)</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-gray-500">BoÅŸ (B)</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-gray-500">Toplam Soru</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-indigo-600">Net</th>
                        </tr>
                    </thead>
                    <tbody id="sozel-sonuc-tablosu" class="bg-white divide-y divide-gray-200">
                        <tr id="row-turkce" class="tablo-satir">
                            <th class="px-3 py-2 text-left text-sm whitespace-nowrap">TÃ¼rkÃ§e</th>
                            <td class="px-3 py-2 text-center"><input type="number" id="turkce-d" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="turkce-y" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="turkce-b" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center text-sm font-semibold">12</td>
                            <td id="turkce-net" class="px-3 py-2 text-center text-sm font-bold text-indigo-600">0.00</td>
                        </tr>
                        <tr id="row-sosyal" class="tablo-satir">
                            <th class="px-3 py-2 text-left text-sm whitespace-nowrap">Sosyal</th>
                            <td class="px-3 py-2 text-center"><input type="number" id="sosyal-d" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="sosyal-y" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="sosyal-b" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center text-sm font-semibold">6</td>
                            <td id="sosyal-net" class="px-3 py-2 text-center text-sm font-bold text-indigo-600">0.00</td>
                        </tr>
                        <tr id="row-din" class="tablo-satir">
                            <th class="px-3 py-2 text-left text-sm whitespace-nowrap">Din KÃ¼ltÃ¼rÃ¼</th>
                            <td class="px-3 py-2 text-center"><input type="number" id="din-d" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="din-y" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="din-b" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center text-sm font-semibold">6</td>
                            <td id="din-net" class="px-3 py-2 text-center text-sm font-bold text-indigo-600">0.00</td>
                        </tr>
                        <tr id="row-ingilizce" class="tablo-satir">
                            <th class="px-3 py-2 text-left text-sm whitespace-nowrap">Ä°ngilizce</th>
                            <td class="px-3 py-2 text-center"><input type="number" id="ingilizce-d" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="ingilizce-y" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="ingilizce-b" value="0" min="0" max="6" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center text-sm font-semibold">6</td>
                            <td id="ingilizce-net" class="px-3 py-2 text-center text-sm font-bold text-indigo-600">0.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-100">
                <p class="text-lg font-bold text-gray-700">Toplam SÃ¶zel Net: <span id="toplam-sozel-net" class="text-indigo-600">0.00</span></p>
                <button id="calculate-sozel" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg transition duration-150">
                    Hesapla ve Kaydet
                </button>
            </div>
        </div>

        <h2 class="text-2xl font-bold text-gray-700 pt-6 border-t border-gray-200">SÃ¶zel Net DaÄŸÄ±lÄ±m GrafiÄŸi</h2>
        <div class="analiz-card">
            <canvas id="sozelGrafikDetay"></canvas>
        </div>

        <div class="analiz-card mt-6 p-4">
            <p class="text-sm text-gray-600">
                * **Hesaplama Notu:** Netler $\text{DoÄŸru} - (\text{YanlÄ±ÅŸ} / 3)$ formÃ¼lÃ¼ ile hesaplanmÄ±ÅŸtÄ±r. Toplam SÃ¶zel Net, bu dÃ¶rt dersin netlerinin toplamÄ±dÄ±r.
            </p>
        </div>
    </main>
    
    <main id="content-sayisal" class="hidden space-y-8">
        <div class="analiz-card">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">SayÄ±sal Net Hesaplama</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-3 text-left text-sm font-medium text-gray-700">Ders</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-green-600">DoÄŸru (D)</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-red-600">YanlÄ±ÅŸ (Y)</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-gray-500">BoÅŸ (B)</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-gray-500">Toplam Soru</th>
                            <th class="px-3 py-3 text-center text-sm font-medium text-indigo-600">Net</th>
                        </tr>
                    </thead>
                    <tbody id="sayisal-sonuc-tablosu" class="bg-white divide-y divide-gray-200">
                         <tr id="row-matematik" class="tablo-satir">
                            <th class="px-3 py-2 text-left text-sm whitespace-nowrap">Matematik</th>
                            <td class="px-3 py-2 text-center"><input type="number" id="matematik-d" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="matematik-y" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="matematik-b" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center text-sm font-semibold">12</td>
                            <td id="matematik-net" class="px-3 py-2 text-center text-sm font-bold text-indigo-600">0.00</td>
                        </tr>
                        <tr id="row-fen" class="tablo-satir">
                            <th class="px-3 py-2 text-left text-sm whitespace-nowrap">Fen Bilimleri</th>
                            <td class="px-3 py-2 text-center"><input type="number" id="fen-d" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="fen-y" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center"><input type="number" id="fen-b" value="0" min="0" max="12" class="input-alan border rounded"></td>
                            <td class="px-3 py-2 text-center text-sm font-semibold">12</td>
                            <td id="fen-net" class="px-3 py-2 text-center text-sm font-bold text-indigo-600">0.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="flex flex-col space-y-4 lg:flex-row lg:justify-between lg:items-center mt-6 pt-4 border-t border-gray-100">
                <p class="text-lg font-bold text-gray-700">Toplam SayÄ±sal Net: <span id="toplam-sayisal-net" class="text-indigo-600">0.00</span></p>

                <div class="flex items-center space-x-2">
                    <label for="manuel-agis-puani" class="text-md font-bold text-gray-700">AGÄ°S PuanÄ± (Manuel):</label>
                    <input type="number" id="manuel-agis-puani" value="0.00" min="0" max="500" step="0.01" class="input-alan border rounded p-1 text-lg font-bold text-indigo-700">
                </div>

                <button id="calculate-sayisal" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg transition duration-150">
                    Hesapla ve Kaydet
                </button>
            </div>
        </div>

        <h2 class="text-2xl font-bold text-gray-700 pt-6 border-t border-gray-200">SayÄ±sal Net DaÄŸÄ±lÄ±m GrafiÄŸi</h2>
        <div class="analiz-card">
            <canvas id="sayisalGrafikDetay"></canvas>
        </div>

        <div class="analiz-card mt-6 p-4">
            <p class="text-sm font-bold text-gray-700 mb-2">Genel AGÄ°S PuanÄ±:</p>
            <p class="text-3xl font-extrabold text-indigo-700"><span id="gosterilen-agis-puani">0.00</span></p>
            <p class="text-sm text-gray-600 mt-2">
                * **Hesaplama Notu:** GÃ¶sterilen AGÄ°S PuanÄ±, Manuel GiriÅŸ alanÄ±ndaki deÄŸeri yansÄ±tÄ±r.
            </p>
        </div>
    </main>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="js/firebase-init.js"></script> 

<script>
    let sozelChartInstance = null;
    let sayisalChartInstance = null;
    let authUser = null;

    // LGS Soru DaÄŸÄ±lÄ±mÄ± ve Net Verisi (GÃœNCELLENMÄ°Å)
    const subjectDetails = {
        'turkce': { max: 12, net: 0, label: 'TÃ¼rkÃ§e' },
        'sosyal': { max: 6, net: 0, label: 'Sosyal' },
        'din': { max: 6, net: 0, label: 'Din K.' },
        'ingilizce': { max: 6, net: 0, label: 'Ä°ngilizce' },
        'matematik': { max: 12, net: 0, label: 'Matematik' },
        'fen': { max: 12, net: 0, label: 'Fen Bil.' }
    };

    const sozelSubjects = ['turkce', 'sosyal', 'din', 'ingilizce'];
    const sayisalSubjects = ['matematik', 'fen'];
    const AGIS_COLLECTION = 'agisUserManualData'; // Firestore koleksiyon adÄ±

    // --------------------------------------------------------------------------------
    // 1. GÄ°RÄ°Å KONTROLÃœ VE HESAPLAMA
    // --------------------------------------------------------------------------------

    // Girdi alanlarÄ±nÄ±n toplamÄ±nÄ±n max soruyu geÃ§memesi iÃ§in kontrol
    function validateInput(subject, maxQuestions) {
        const d = parseInt(document.getElementById(`${subject}-d`).value) || 0;
        const y = parseInt(document.getElementById(`${subject}-y`).value) || 0;
        const b = parseInt(document.getElementById(`${subject}-b`).value) || 0;
        
        const total = d + y + b;
        
        // Negatif deÄŸerleri 0'a Ã§ek
        if (d < 0) document.getElementById(`${subject}-d`).value = 0;
        if (y < 0) document.getElementById(`${subject}-y`).value = 0;
        if (b < 0) document.getElementById(`${subject}-b`).value = 0;

        // Toplam soru sayÄ±sÄ±nÄ± kontrol et
        if (total > maxQuestions) {
            alert(`Hata: ${subjectDetails[subject].label} dersinde toplam soru sayÄ±sÄ± ${maxQuestions}'Ã¼ (${d}D + ${y}Y + ${b}B = ${total}) geÃ§emez. LÃ¼tfen giriÅŸleri kontrol edin.`);
            // Hata durumunda fazla girilen deÄŸeri BoÅŸ hanesinden Ã§Ä±kararak dÃ¼zeltme yap (kullanÄ±cÄ± dostu Ã§Ã¶zÃ¼m)
            const excess = total - maxQuestions;
            if (b >= excess) {
                 document.getElementById(`${subject}-b`).value = b - excess;
            } else if (y >= excess) {
                 document.getElementById(`${subject}-y`).value = y - excess;
            } else {
                 document.getElementById(`${subject}-d`).value = d - excess;
            }
        }
        
        // GiriÅŸ deÄŸiÅŸtiÄŸinde otomatik kaydetme/render'Ä± tetikler
        const category = sozelSubjects.includes(subject) ? 'sozel' : 'sayisal';
        calculateAndRender(category, true);
    }
    
    function calculateAndRender(category, autoSave = false) {
        if (category === 'sozel') {
            const result = calculateCategoryNets(sozelSubjects);
            document.getElementById('toplam-sozel-net').textContent = result.totalNet.toFixed(2);
            renderChart('sozel');
        } else {
            const result = calculateCategoryNets(sayisalSubjects);
            document.getElementById('toplam-sayisal-net').textContent = result.totalNet.toFixed(2);
            // Manuel AGIS PuanÄ±nÄ± SayÄ±sal sonuÃ§ alanÄ±na yansÄ±t
            updateGeneralAgisScore(); 
            renderChart('sayisal');
        }
        
        // Manuel AGIS puanÄ± deÄŸiÅŸirse, onu da anlÄ±k olarak yansÄ±talÄ±m.
        if (category === 'sayisal') {
            updateGeneralAgisScore();
        }

        // Otomatik kaydetme veya butona basma durumunda kaydet
        if (!autoSave || (autoSave && authUser)) {
             saveAgisData();
        }
    }
    
    function calculateCategoryNets(subjects) {
        let totalNet = 0;
        subjects.forEach(subject => {
            const d = Math.max(0, parseInt(document.getElementById(`${subject}-d`).value) || 0);
            const y = Math.max(0, parseInt(document.getElementById(`${subject}-y`).value) || 0);
            
            // Net Hesaplama: D - (Y / 3)
            let net = d - (y / 3);
            net = Math.max(0, net); // Net negatif olamaz
            net = Math.min(subjectDetails[subject].max, net); // Net, toplam soru sayÄ±sÄ±nÄ± geÃ§emez
            
            subjectDetails[subject].net = net;
            totalNet += net;

            document.getElementById(`${subject}-net`).textContent = net.toFixed(2);
        });
        return { totalNet };
    }

    function updateGeneralAgisScore() {
        // Genel puanÄ± manuel giriÅŸ alanÄ±ndan Ã§ek
        const agisScoreInput = document.getElementById('manuel-agis-puani');
        const agisScore = parseFloat(agisScoreInput.value) || 0.00;
        
        document.getElementById('gosterilen-agis-puani').textContent = agisScore.toFixed(2);
    }
    
    // --------------------------------------------------------------------------------
    // 2. VERÄ° KAYDETME VE YÃœKLEME (FIREBASE)
    // --------------------------------------------------------------------------------

    function saveAgisData() {
        if (!authUser || typeof db === 'undefined') return;

        const dataToSave = {};

        // SÃ¶zel ve SayÄ±sal input deÄŸerlerini topla
        [...sozelSubjects, ...sayisalSubjects].forEach(subject => {
            dataToSave[`${subject}_d`] = parseInt(document.getElementById(`${subject}-d`).value) || 0;
            dataToSave[`${subject}_y`] = parseInt(document.getElementById(`${subject}-y`).value) || 0;
            dataToSave[`${subject}_b`] = parseInt(document.getElementById(`${subject}-b`).value) || 0;
        });

        // Manuel AGÄ°S PuanÄ±nÄ± kaydet
        dataToSave['manuel_agis_puani'] = parseFloat(document.getElementById('manuel-agis-puani').value) || 0.00;
        
        db.collection(AGIS_COLLECTION).doc(authUser.uid).set(dataToSave, { merge: true })
        .then(() => {
            console.log("AGIS verileri baÅŸarÄ±yla kaydedildi.");
        })
        .catch((error) => {
            console.error("AGIS verileri kaydedilirken hata:", error);
        });
    }

    function loadAgisData() {
        if (!authUser || typeof db === 'undefined') return;

        db.collection(AGIS_COLLECTION).doc(authUser.uid).get()
        .then(doc => {
            if (doc.exists) {
                const data = doc.data();
                
                // Input alanlarÄ±nÄ± doldur
                [...sozelSubjects, ...sayisalSubjects].forEach(subject => {
                    document.getElementById(`${subject}-d`).value = data[`${subject}_d`] || 0;
                    document.getElementById(`${subject}-y`).value = data[`${subject}_y`] || 0;
                    document.getElementById(`${subject}-b`).value = data[`${subject}_b`] || 0;
                });

                // Manuel AGÄ°S PuanÄ±nÄ± doldur
                document.getElementById('manuel-agis-puani').value = data['manuel_agis_puani'] || 0.00;

                // Veriler yÃ¼klendikten sonra hesapla ve render et
                calculateAndRender('sozel', false);
                calculateAndRender('sayisal', false);
                console.log("AGIS verileri yÃ¼klendi.");

            } else {
                 // Veri yoksa, varsayÄ±lan deÄŸerlerle hesapla
                 calculateAndRender('sozel', false);
                 calculateAndRender('sayisal', false);
            }
        })
        .catch((error) => {
            console.error("AGIS verileri yÃ¼klenirken hata:", error);
            // Hata durumunda bile varsayÄ±lan deÄŸerlerle hesapla
            calculateAndRender('sozel', false);
            calculateAndRender('sayisal', false);
        });
    }


    // --------------------------------------------------------------------------------
    // 3. GRAFÄ°K RENDER Ä°ÅLEVLERÄ°
    // --------------------------------------------------------------------------------

    function renderChart(category) {
        const chartId = category === 'sozel' ? 'sozelGrafikDetay' : 'sayisalGrafikDetay';
        let chartInstance = category === 'sozel' ? sozelChartInstance : sayisalChartInstance;
        
        if (chartInstance) {
            chartInstance.destroy();
        }
        
        const ctx = document.getElementById(chartId).getContext('2d');
        const subjects = category === 'sozel' ? sozelSubjects : sayisalSubjects;
        
        const labels = subjects.map(s => subjectDetails[s].label);
        const nets = subjects.map(s => subjectDetails[s].net);
        const maxQuestions = subjects.map(s => subjectDetails[s].max); 

        const datasetColor = category === 'sozel' ? '#4f46e5' : '#10b981'; // Indigo (SÃ¶zel), Emerald (SayÄ±sal)
        const titleText = category === 'sozel' ? 'SÃ¶zel Dersler Net DaÄŸÄ±lÄ±mÄ±' : 'SayÄ±sal Dersler Net DaÄŸÄ±lÄ±mÄ±';
        
        chartInstance = new Chart(ctx, {
            type: 'bar', 
            data: {
                labels: labels,
                datasets: [{
                    label: 'Hesaplanan Net',
                    data: nets,
                    backgroundColor: datasetColor,
                    borderColor: datasetColor,
                    borderWidth: 1,
                },
                {
                    type: 'line',
                    label: 'Maks. Soru SayÄ±sÄ±',
                    data: maxQuestions,
                    borderColor: '#94a3b8',
                    backgroundColor: '#94a3b8',
                    fill: false,
                    borderDash: [5, 5]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: {
                        display: true,
                        text: titleText
                    }
                },
                scales: {
                    x: {
                        ticks: { maxRotation: 45, minRotation: 45 }
                    },
                    y: {
                        beginAtZero: true,
                        max: 12, /* En yÃ¼ksek soru sayÄ±sÄ±na (TÃ¼rkÃ§e/Matematik) gÃ¶re ayarlandÄ± */
                        title: { display: true, text: 'Net SayÄ±sÄ±' }
                    }
                }
            }
        });

        if (category === 'sozel') {
            sozelChartInstance = chartInstance;
        } else {
            sayisalChartInstance = chartInstance;
        }
    }

    // --------------------------------------------------------------------------------
    // 4. TAB VE BAÄLANTI Ä°ÅLEVLERÄ° (EventListeners)
    // --------------------------------------------------------------------------------

    function switchTab(target) {
        const sozelContent = document.getElementById('content-sozel');
        const sayisalContent = document.getElementById('content-sayisal');
        const sozelTab = document.getElementById('tab-sozel');
        const sayisalTab = document.getElementById('tab-sayisal');

        if (target === 'sozel') {
            sozelContent.classList.remove('hidden');
            sayisalContent.classList.add('hidden');
            sozelTab.classList.add('active-tab');
            sayisalTab.classList.remove('active-tab');
        } else {
            sozelContent.classList.add('hidden');
            sayisalContent.classList.remove('hidden');
            sayisalTab.classList.add('active-tab');
            sozelTab.classList.remove('active-tab');
        }
    }
    
    function attachEventListeners() {
        // Input fields (Change listener for validation and recalculation)
        const allInputs = document.querySelectorAll('#content-sozel input[type="number"], #content-sayisal input[type="number"]');

        allInputs.forEach(input => {
            const idParts = input.id.split('-'); // e.g., ['turkce', 'd']
            const subject = idParts[0];
            const maxQuestions = subjectDetails[subject].max;
            
            // EÄŸer input AGIS puanÄ± deÄŸilse, validasyon ve kategori hesaplama yap
            if (subject !== 'manuel') {
                input.addEventListener('change', () => {
                    validateInput(subject, maxQuestions);
                });
            }
        });

        // Manuel AGIS PuanÄ± deÄŸiÅŸimini takip et ve kaydet
        document.getElementById('manuel-agis-puani').addEventListener('change', () => {
             updateGeneralAgisScore();
             saveAgisData();
        });

        // Calculate buttons (Click listener) -> ArtÄ±k sadece kaydetme ve render etme
        document.getElementById('calculate-sozel').addEventListener('click', () => {
            calculateAndRender('sozel', false); // Kaydetme butona basÄ±nca
        });
        
        document.getElementById('calculate-sayisal').addEventListener('click', () => {
            calculateAndRender('sayisal', false); // Kaydetme butona basÄ±nca
        });

        // Tab buttons
        document.getElementById('tab-sozel').addEventListener('click', () => switchTab('sozel'));
        document.getElementById('tab-sayisal').addEventListener('click', () => switchTab('sayisal'));
    }

    // Sayfa yÃ¼klendiÄŸinde Firebase baÄŸlantÄ±sÄ±nÄ± kur ve verileri yÃ¼kle
    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            authUser = user;
            loadAgisData(); // GiriÅŸ yapÄ±ldÄ±ysa verileri yÃ¼kle
        } else {
            // GiriÅŸ yapÄ±lmadÄ±ysa bile varsayÄ±lan deÄŸerlerle render et
            calculateAndRender('sozel', false);
            calculateAndRender('sayisal', false);
            alert("UyarÄ±: GiriÅŸ yapmadÄ±ÄŸÄ±nÄ±z iÃ§in AGÄ°S verileriniz kaydedilmeyecektir.");
        }
        attachEventListeners();
    });
</script>

</body>
</html>
